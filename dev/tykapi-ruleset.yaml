rules:
  no-keyless-auth:
    description: APIs must not be keyless
    given: "$.api_definition"
    severity: error
    then:
      field: use_keyless 
      function: falsy

  no-empty-target-url:
    description: APIs must have a target_url
    given: "$.api_definition.proxy"
    severity: error
    then:
      field: 'target_url'
      function: 'pattern'
      functionOptions:
        match: '^(?!\s*$).+'

  check-auth-settings:
    description: Ensure either `enable_jwt` or `use_mutual_tls_auth` is set to true
    message: "Either `enable_jwt` or `use_mutual_tls_auth` must be set to true."
    severity: error
    given: "$.api_definition"
    then:
      function: falsy
      field: "enable_jwt"
      or:
        - field: "use_mutual_tls_auth"
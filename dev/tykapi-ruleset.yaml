rules:
  no-keyless-auth:
    description: APIs must not be keyless
    given: "$.api_definition"
    severity: error
    then:
      field: use_keyless 
      function: falsy

  no-empty-target-url:
    description: APIs must have a target_url
    given: "$.api_definition.proxy"
    severity: error
    then:
      field: 'target_url'
      function: 'pattern'
      functionOptions:
        match: '^(?!\s*$).+'

  check-auth-settings:
    description: 'Either enable_jwt or use_mutual_tls_auth must be true'
    message: 'Either enable_jwt or use_mutual_tls_auth must be set to true.'
    given: '$'
    then:
      anyOf:
        - path: '$.enable_jwt'
          condition: 'true'
        - path: '$.use_mutual_tls_auth'
          condition: 'true'
    severity: error
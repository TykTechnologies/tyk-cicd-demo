rules:
  no-keyless-auth:
    description: APIs must not be keyless
    given: "$.use_keyless"
    severity: error
    then:
      field: use_keyless 
      function: truthy

  no-empty-target-url:
    description: APIs must have a target_url
    given: "$.proxy"
    severity: error
    then:
      field: 'target_url'
      function: 'pattern'
      functionOptions:
        match: '^(?!\s*$).+'

  security-authentication-requirement:
    description: |
      The API specification must specify either JWT authentication or mutual TLS authentication
    message: |
      Either JWT or mutualTLS authentication must be enabled
    given: $
    then:
      field: $
      function: pattern
      functionOptions:
        pattern: '^(?!.*(enable_jwt: true|auth_configs:.*use_mutual_tls_auth: true)).*'
      severity: error